<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TestNgReportListener | Chaos</title>
<link rel="shortcut icon" href="https://chaosreigned.github.io/favicon.ico?v=1598434205831">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://chaosreigned.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="TestNgReportListener | Chaos - Atom Feed" href="https://chaosreigned.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="TestNgReportListener
public class TestNgReportListener implements IReporter {
    private static Logger logger = LoggerF..." />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://chaosreigned.github.io">
  <img class="avatar" src="https://chaosreigned.github.io/images/avatar.png?v=1598434205831" alt="">
  </a>
  <h1 class="site-title">
    Chaos
  </h1>
  <p class="site-description">
    温故而知新
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              TestNgReportListener
            </h2>
            <div class="post-info">
              <span>
                2020-08-26
              </span>
              <span>
                19 min read
              </span>
              
            </div>
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <h3 id="testngreportlistener">TestNgReportListener</h3>
<pre><code>public class TestNgReportListener implements IReporter {
    private static Logger logger = LoggerFactory.getLogger(ThreadUtil.getClassName());
    public static final String OUTPUT_DIRECTORY = &quot;report&quot;;
    public static final String OUTPUT_FILE = &quot;index.html&quot;;

    public TestNgReportListener() {
    }

    public void generateReport(List&lt;XmlSuite&gt; xmlSuites, List&lt;ISuite&gt; suites, String outputDirectory) {
        Map&lt;String, TestPackageResult&gt; testResults = (new TestNgResultCollector(suites)).collect();
        String suiteName = ((ISuite)suites.get(0)).getName();
        TestReport testReport = new HtmlTestReport(suiteName, testResults, TestEnvHandover.get(), &quot;report&quot;);
        testReport.generate().publish(&quot;index.html&quot;);
    }
}
</code></pre>
<h3 id="testngresultcollector">TestNgResultCollector</h3>
<pre><code>public class TestNgResultCollector implements TestResultCollector {
    private static Logger logger = LoggerFactory.getLogger(ThreadUtil.getClassName());
    private List&lt;ISuite&gt; testNgSuites;
    protected Map&lt;String, TestPackageResult&gt; sortedTestResults = new TreeMap();

    public TestNgResultCollector(List&lt;ISuite&gt; testNgSuites) {
        this.testNgSuites = testNgSuites;
    }

    public Map&lt;String, TestPackageResult&gt; collect() {
        Iterator var1 = this.testNgSuites.iterator();

        while(var1.hasNext()) {
            ISuite suite = (ISuite)var1.next();
            logger.info(&quot;Suite name: {}&quot;, suite.getName());
            Iterator var3 = suite.getResults().entrySet().iterator();

            while(var3.hasNext()) {
                Entry&lt;String, ISuiteResult&gt; entry = (Entry)var3.next();
                logger.info(&quot;Test name: {}&quot;, entry.getKey());
                this.sortTestResultsByTestPackage(((ISuiteResult)entry.getValue()).getTestContext(), this.sortedTestResults);
            }
        }

        return this.sortedTestResults;
    }

    private void sortTestResultsByTestPackage(ITestContext testContext, Map&lt;String, TestPackageResult&gt; testPackageResults) {
        Map&lt;String, TestClassResult&gt; testClassResults = new TreeMap();
        this.sortTestResultsByTestClass(testContext, testClassResults);
        Iterator var4 = testClassResults.values().iterator();

        while(var4.hasNext()) {
            TestClassResult testClassResult = (TestClassResult)var4.next();
            String packageName = testClassResult.getTestClassName().substring(0, testClassResult.getTestClassName().lastIndexOf(&quot;.&quot;));
            if (!testPackageResults.containsKey(packageName)) {
                logger.debug(&quot;Put package {}&quot;, packageName);
                testPackageResults.put(packageName, new TestPackageResult(packageName, testClassResult));
            } else {
                ((TestPackageResult)testPackageResults.get(packageName)).addTestClassResult(testClassResult);
            }
        }

    }

    private void sortTestResultsByTestClass(ITestContext testContext, Map&lt;String, TestClassResult&gt; testClassResults) {
        Map&lt;String, List&lt;ITestResult&gt;[]&gt; testResultsByClass = new TreeMap();
        logger.debug(&quot;Entry before sort: &quot; + testResultsByClass.size());
        this.sortTestResultsByTestStatus(testContext.getFailedTests(), testResultsByClass, 2);
        this.sortTestResultsByTestStatus(testContext.getSkippedTests(), testResultsByClass, 3);
        this.sortTestResultsByTestStatus(testContext.getPassedTests(), testResultsByClass, 1);
        this.sortTestResultsByTestStatus(testContext.getFailedButWithinSuccessPercentageTests(), testResultsByClass, 4);
        IResultMap[] testConfigResultMaps = new IResultMap[]{testContext.getFailedConfigurations(), testContext.getSkippedConfigurations(), testContext.getPassedConfigurations()};
        Map&lt;String, List&lt;TestResult&gt;&gt; sortedTestConfigResults = this.sortTestConfigResultsByTestClass(testConfigResultMaps);
        logger.debug(&quot;Entry after sort: &quot; + testResultsByClass.size());
        Iterator var6 = testResultsByClass.entrySet().iterator();

        while(var6.hasNext()) {
            Entry&lt;String, List&lt;ITestResult&gt;[]&gt; testResultByClass = (Entry)var6.next();
            logger.info(&quot;Name: {}&quot;, testResultByClass.getKey());
            logger.info(&quot;Length: {}&quot;, ((List[])testResultByClass.getValue()).length);
            logger.info(&quot;FAIL: {}&quot;, ((List[])testResultByClass.getValue())[2].size());
            logger.info(&quot;SKIP: {}&quot;, ((List[])testResultByClass.getValue())[3].size());
            logger.info(&quot;SUCCESS: {}&quot;, ((List[])testResultByClass.getValue())[1].size());
            testClassResults.put(testResultByClass.getKey(), new TestNgTestClassResult((String)testResultByClass.getKey(), this.getEarliestTestStartTime((List)sortedTestConfigResults.get(testResultByClass.getKey()), (List[])testResultByClass.getValue()), this.getLatestTestEndTime((List)sortedTestConfigResults.get(testResultByClass.getKey()), (List[])testResultByClass.getValue()), ((List[])testResultByClass.getValue())[2], ((List[])testResultByClass.getValue())[3], ((List[])testResultByClass.getValue())[1]));
        }

    }

    private void sortTestResultsByTestStatus(IResultMap resultMap, Map&lt;String, List&lt;ITestResult&gt;[]&gt; testResultsByClass, int status) {
        Iterator var4 = resultMap.getAllResults().iterator();

        while(var4.hasNext()) {
            ITestResult testNgResult = (ITestResult)var4.next();
            logger.info(testNgResult.getTestClass() + &quot; &quot; + testNgResult.getName() + &quot; &quot; + testNgResult.getTestName() + &quot; &quot; + testNgResult.getStatus() + &quot; &quot;);
            if (!testResultsByClass.containsKey(testNgResult.getTestClass().getRealClass().getName())) {
                logger.debug(&quot;Put class {}&quot;, testNgResult.getTestClass().getRealClass().getName());
                testResultsByClass.put(testNgResult.getTestClass().getRealClass().getName(), new ArrayList[5]);

                for(int i = 0; i &lt; ((List[])testResultsByClass.get(testNgResult.getTestClass().getRealClass().getName())).length; ++i) {
                    ((List[])testResultsByClass.get(testNgResult.getTestClass().getRealClass().getName()))[i] = new ArrayList();
                }
            }

            if (((List[])testResultsByClass.get(testNgResult.getTestClass().getRealClass().getName()))[status] != null) {
                logger.debug(&quot;Add test {}&quot;, testNgResult.getName());
                ((List[])testResultsByClass.get(testNgResult.getTestClass().getRealClass().getName()))[status].add(testNgResult);
            }
        }

    }

    private Map&lt;String, List&lt;TestResult&gt;&gt; sortTestConfigResultsByTestClass(IResultMap[] resultMaps) {
        Map&lt;String, List&lt;TestResult&gt;&gt; testResults = new TreeMap();
        Set&lt;ITestResult&gt; allResults = new TreeSet();
        IResultMap[] var4 = resultMaps;
        int var5 = resultMaps.length;

        for(int var6 = 0; var6 &lt; var5; ++var6) {
            IResultMap resultMap = var4[var6];
            allResults.addAll(resultMap.getAllResults());
        }

        Iterator var12 = allResults.iterator();

        while(true) {
            while(var12.hasNext()) {
                ITestResult testNgResult = (ITestResult)var12.next();
                logger.debug(testNgResult.getTestClass() + &quot; &quot; + testNgResult.getName() + &quot; &quot; + testNgResult.getStatus() + &quot; &quot;);
                Method realMethod = testNgResult.getMethod().getConstructorOrMethod().getMethod();
                BeforeSuite bs = (BeforeSuite)realMethod.getAnnotation(BeforeSuite.class);
                AfterSuite as = (AfterSuite)realMethod.getAnnotation(AfterSuite.class);
                BeforeTest bt = (BeforeTest)realMethod.getAnnotation(BeforeTest.class);
                AfterTest at = (AfterTest)realMethod.getAnnotation(AfterTest.class);
                if (bs == null &amp;&amp; as == null &amp;&amp; bt == null &amp;&amp; at == null) {
                    if (!testResults.containsKey(testNgResult.getTestClass().getRealClass().getName())) {
                        testResults.put(testNgResult.getTestClass().getRealClass().getName(), new ArrayList());
                    }

                    TestResult testResult = new TestResult(&quot;0&quot;, testNgResult.getName(), testNgResult.getTestName(), testNgResult.getStatus(), testNgResult.getStartMillis(), testNgResult.getEndMillis());
                    ((List)testResults.get(testNgResult.getTestClass().getRealClass().getName())).add(testResult);
                } else {
                    logger.info(&quot;Method {} is a suite level method. Ignore.&quot;, testNgResult.getMethod().getMethodName());
                }
            }

            return testResults;
        }
    }

    private long getEarliestTestStartTime(List&lt;TestResult&gt; testResults, List&lt;ITestResult&gt;[] testResultsByClass) {
        long startTimeInMillis = 0L;
        TestResult testConfigResult;
        if (testResults == null) {
            logger.info(&quot;testResults is null.&quot;);
        } else {
            for(Iterator var5 = testResults.iterator(); var5.hasNext(); startTimeInMillis = startTimeInMillis &gt; testConfigResult.getStartTimeInMillis() ? testConfigResult.getStartTimeInMillis() : startTimeInMillis) {
                testConfigResult = (TestResult)var5.next();
                startTimeInMillis = startTimeInMillis == 0L ? testConfigResult.getStartTimeInMillis() : startTimeInMillis;
            }
        }

        if (testResultsByClass == null) {
            logger.info(&quot;testResultsByClass is null.&quot;);
        } else {
            List[] var11 = testResultsByClass;
            int var12 = testResultsByClass.length;

            for(int var7 = 0; var7 &lt; var12; ++var7) {
                List&lt;ITestResult&gt; testResultList = var11[var7];

                ITestResult testResult;
                for(Iterator var9 = testResultList.iterator(); var9.hasNext(); startTimeInMillis = startTimeInMillis &gt; testResult.getStartMillis() ? testResult.getStartMillis() : startTimeInMillis) {
                    testResult = (ITestResult)var9.next();
                    startTimeInMillis = startTimeInMillis == 0L ? testResult.getStartMillis() : startTimeInMillis;
                }
            }
        }

        return startTimeInMillis;
    }

    private long getLatestTestEndTime(List&lt;TestResult&gt; testResults, List&lt;ITestResult&gt;[] testResultsByClass) {
        long endTimeInMillis = 0L;
        TestResult testConfigResult;
        if (testResults == null) {
            logger.info(&quot;testResults is null.&quot;);
        } else {
            for(Iterator var5 = testResults.iterator(); var5.hasNext(); endTimeInMillis = endTimeInMillis &lt; testConfigResult.getEndTimeInMillis() ? testConfigResult.getEndTimeInMillis() : endTimeInMillis) {
                testConfigResult = (TestResult)var5.next();
            }
        }

        if (testResultsByClass == null) {
            logger.info(&quot;testResultsByClass is null.&quot;);
        } else {
            List[] var11 = testResultsByClass;
            int var12 = testResultsByClass.length;

            for(int var7 = 0; var7 &lt; var12; ++var7) {
                List&lt;ITestResult&gt; testResultList = var11[var7];

                ITestResult testResult;
                for(Iterator var9 = testResultList.iterator(); var9.hasNext(); endTimeInMillis = endTimeInMillis &lt; testResult.getEndMillis() ? testResult.getEndMillis() : endTimeInMillis) {
                    testResult = (ITestResult)var9.next();
                }
            }
        }

        return endTimeInMillis;
    }
}
</code></pre>
<h3 id="htmltestreport">HtmlTestReport</h3>
<pre><code>public class HtmlTestReport extends AbstractTestReport implements TestReport {
    private static Logger logger = LoggerFactory.getLogger(ThreadUtil.getClassName());
    private String html;
    private String summary;
    String outputDirectoryName;
    private static final String SUMMARY_FILE_NAME = &quot;summary&quot;;
    static final String GIT_LAB_URL_PREFIX = &quot;http://git.jd.com/cloud-storage/oss-test/blob/master/jss_test/src/main/java/&quot;;
    private static final String TEST_JOURNAL_PATH_TO_FILE;
    private static final String TEST_RESULT_ARCHIVE_LINK = &quot;http://git.jd.com/cloud-storage/jdcloud-test-ci-results/tree/master/jss&quot;;
    private static final String TEST_RESULT_ARCHIVE_DISPLAY = &quot;jdcloud-test-ci-results/jss&quot;;

    public HtmlTestReport(String suiteName, Map&lt;String, TestPackageResult&gt; testResults, TestEnvInfo testEnvInfo, String outputDirectoryName) {
        super(suiteName, testResults, testEnvInfo);
        this.outputDirectoryName = outputDirectoryName;
    }

    public TestReport generate() {
        this.html = this.generateHtml();
        this.summary = this.getResultSummary();
        return this;
    }

    public void publish(String outputFile) {
        this.publishHtml(outputFile);
    }

    private String generateHtml() {
        String currentTimeStr = DateUtil.formatTime(DateUtil.getCurrentTime(), DateUtil.FORMAT_SIMPLE, TimeZone.getTimeZone(&quot;GMT+8&quot;));
        StringBuilder body = new StringBuilder();
        body.append(&quot;&lt;h3&gt;&quot;).append(this.getResultSummary()).append(&quot;&lt;/h3&gt;\n&quot;);
        body.append(&quot;&lt;h5&gt;Report generated at &quot;).append(currentTimeStr).append(&quot;&lt;/h5&gt;\n&quot;);
        body.append(&quot;&lt;!--&lt;p class='info'&gt;&lt;a href=#&gt;See this report in web browser&lt;/a&gt;&lt;/p&gt;--&gt;\n&quot;);
        body.append(this.generateSummary());
        body.append(this.generateEnvInfo());
        body.append(this.generateDetail());
        String head = &quot;&lt;meta http-equiv=\&quot;Content-Type\&quot; content=\&quot;text/html; charset=utf-8\&quot;/&gt;\n&lt;style type=\&quot;text/css\&quot;&gt;\nh3 { font-family:Arial; }\nh5 { font-family:Arial; }\ntd { font-family:Arial; font-size: 14px; }\ntd.th { font-family:Arial; font-size: 14px; font-weight: bold}\ntd.packagebanner { font-family:Arial; font-size: 14px; font-weight: bold}\ntable { border-collapse: collapse; }\np.info { font-family: Arial; font-size: 14px; }\na.source {text-decoration: none}\n&lt;/style&gt;&quot;;
        return &quot;&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&quot; + head + &quot;&lt;/head&gt;\n&lt;body&gt;\n&quot; + body + &quot;&lt;/body&gt;\n&lt;/html&gt;\n&quot;;
    }

    private String generateEnvInfo() {
        StringBuilder sb = new StringBuilder();
        sb.append(&quot;&lt;hr align=left width=1200&gt;\n&quot;);
        sb.append(&quot;&lt;table border=0 width=1200 cellspacing=1&gt;\n&quot;);
        sb.append(this.generateEnvLine(&quot;IP&quot;, this.testEnvInfo == null ? null : this.testEnvInfo.getIpInfo(), true));
        sb.append(this.generateEnvLine(&quot;Endpoint&quot;, this.testEnvInfo == null ? null : this.testEnvInfo.getEndpointInfo(), true));
        sb.append(this.generateEnvLine(&quot;Test configuration&quot;, this.testEnvInfo == null ? null : mapToPrintableList(this.testEnvInfo.getConfigInfo(), 4), true));
        sb.append(this.generateEnvLine(&quot;Ark info&quot;, &quot;Application: $application | Branch: $branch | Version: $version&quot;));
        sb.append(this.generateEnvLine(&quot;Test code branch&quot;, &quot;$test_code_branch&quot;));
        sb.append(this.generateEnvLine(&quot;Test Journal&quot;, &quot;&lt;a href='&quot; + TEST_JOURNAL_PATH_TO_FILE + &quot;'&gt;Test Log&lt;/a&gt;&quot;));
        sb.append(&quot;&lt;/table&gt;&quot;);
        return sb.toString();
    }

    private String generateEnvLine(String name, String value) {
        return this.generateEnvLine(name, Collections.singletonList(value), true);
    }

    private String generateEnvLine(String name, List&lt;String&gt; values, boolean singleRow) {
        StringBuilder sb = new StringBuilder();
        if (singleRow) {
            sb.append(&quot;&lt;tr&gt;\n&quot;);
            sb.append(&quot;&lt;td class='th'&gt;&quot;).append(name).append(&quot;&lt;/td&gt;\n&quot;);
            if (values == null) {
                sb.append(&quot;&lt;td&gt;null&lt;/td&gt;\n&quot;);
            } else {
                sb.append(&quot;&lt;td&gt;&quot;).append(String.join(&quot; | &quot;, values)).append(&quot;&lt;/td&gt;\n&quot;);
            }

            sb.append(&quot;&lt;/tr&gt;\n&quot;);
        } else {
            for(int i = 0; i &lt; values.size(); ++i) {
                sb.append(&quot;&lt;tr&gt;\n&quot;);
                if (i == 0) {
                    sb.append(&quot;  &lt;td class='th' rowspan=&quot;).append(values.size()).append(&quot;&gt;&quot;).append(name).append(&quot;&lt;/td&gt;\n&quot;);
                }

                sb.append(&quot;  &lt;td&gt;&quot;).append((String)values.get(i)).append(&quot;&lt;/td&gt;\n&quot;);
                sb.append(&quot;&lt;/tr&gt;\n&quot;);
            }
        }

        return sb.toString();
    }

    private String generateEnvLine(String name, Map&lt;String, String&gt; values) {
        if (values == null) {
            return &quot;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;\n&quot;;
        } else {
            StringBuilder sb = new StringBuilder();
            boolean isName = true;
            Iterator var5 = values.entrySet().iterator();

            while(var5.hasNext()) {
                Entry entry = (Entry)var5.next();
                sb.append(&quot;&lt;tr&gt;\n&quot;);
                if (isName) {
                    sb.append(&quot;  &lt;td class='th' rowspan=&quot;).append(values.size()).append(&quot;&gt;&quot;).append(name).append(&quot;&lt;/td&gt;\n&quot;);
                    isName = false;
                }

                sb.append(&quot;  &lt;td&gt;&quot;).append(entry.getKey()).append(&quot; = &quot;).append(entry.getValue()).append(&quot;&lt;/td&gt;\n&quot;);
                sb.append(&quot;&lt;/tr&gt;\n&quot;);
            }

            return sb.toString();
        }
    }

    private String generateSummary() {
        StringBuilder sb = new StringBuilder();
        sb.append(&quot;&lt;hr align=left width=1200&gt;\n&quot;);
        sb.append(&quot;&lt;table border=0 width=1200 cellspacing=1&gt;\n&quot;);
        sb.append(&quot;&lt;tr&gt;\n&quot;);
        sb.append(&quot;  &lt;td class='th' align=center  width=40%&gt;Package&lt;/td&gt;\n&quot;);
        sb.append(&quot;  &lt;td class='th' align=right witdh=10%&gt;Passed&lt;/td&gt;\n&quot;);
        sb.append(&quot;  &lt;td class='th' align=right witdh=10%&gt;Failed&lt;/td&gt;\n&quot;);
        sb.append(&quot;  &lt;td class='th' align=right witdh=10%&gt;Skipped&lt;/td&gt;\n&quot;);
        sb.append(&quot;  &lt;td class='th' align=right witdh=10%&gt;Total&lt;/td&gt;\n&quot;);
        sb.append(&quot;  &lt;td class='th' align=right witdh=10%&gt;Pass rate&lt;/td&gt;\n&quot;);
        sb.append(&quot;  &lt;td class='th' align=right witdh=10%&gt;Duration&lt;/td&gt;\n&quot;);
        sb.append(&quot;&lt;/tr&gt;\n&quot;);
        Iterator var2 = this.testPackageResults.values().iterator();

        while(var2.hasNext()) {
            TestPackageResult testPackageResult = (TestPackageResult)var2.next();
            int total = testPackageResult.getTotalNumOfTest();
            int passed = testPackageResult.getPassedTestResults().size();
            int failed = testPackageResult.getFailedTestResults().size();
            int skipped = testPackageResult.getSkippedTestResults().size();
            String durationString = ReportUtil.generateDuration(testPackageResult.getStartTimeInMillis(), testPackageResult.getEndTimeInMillis());
            sb.append(&quot;&lt;tr&gt;\n&quot;);
            sb.append(&quot;  &lt;td&gt;&lt;a href='#&quot;).append(testPackageResult.getTestPackageName()).append(&quot;'&gt;&quot;).append(testPackageResult.getTestPackageName()).append(&quot;&lt;/a&gt;&lt;/td&gt;\n&quot;);
            sb.append(&quot;  &lt;td align=right&gt;&quot;).append(passed).append(&quot;&lt;/td&gt;\n&quot;);
            sb.append(&quot;  &lt;td align=right&gt;&quot;).append(failed).append(&quot;&lt;/td&gt;\n&quot;);
            sb.append(&quot;  &lt;td align=right&gt;&quot;).append(skipped).append(&quot;&lt;/td&gt;\n&quot;);
            sb.append(&quot;  &lt;td align=right&gt;&quot;).append(total).append(&quot;&lt;/td&gt;\n&quot;);
            sb.append(&quot;  &lt;td align=right&gt;&quot;).append(testPackageResult.getPassRate()).append(&quot;&lt;/td&gt;\n&quot;);
            sb.append(&quot;  &lt;td align=right&gt;&quot;).append(durationString).append(&quot;&lt;/td&gt;\n&quot;);
            sb.append(&quot;&lt;/tr&gt;\n&quot;);
        }

        sb.append(&quot;&lt;tr&gt;\n&quot;);
        sb.append(&quot;  &lt;td class='th' align=center&gt;Overall&lt;/td&gt;\n&quot;);
        sb.append(&quot;  &lt;td class='th' align=right&gt;&quot;).append(this.overallPassed).append(&quot;&lt;/td&gt;\n&quot;);
        sb.append(&quot;  &lt;td class='th' align=right&gt;&quot;).append(this.overallFailed).append(&quot;&lt;/td&gt;\n&quot;);
        sb.append(&quot;  &lt;td class='th' align=right&gt;&quot;).append(this.overallSkipped).append(&quot;&lt;/td&gt;\n&quot;);
        sb.append(&quot;  &lt;td class='th' align=right&gt;&quot;).append(this.overallTotal).append(&quot;&lt;/td&gt;\n&quot;);
        sb.append(&quot;  &lt;td class='th' align=right&gt;&quot;).append(this.getPassRate()).append(&quot;&lt;/td&gt;\n&quot;);
        String overallDuration = this.overallDurationInSecond + &quot; s&quot;;
        if (this.overallDurationInSecond &gt; 180) {
            if (this.overallDurationInSecond % 60 &gt; 10) {
                overallDuration = this.overallDurationInSecond / 60 + 1 + &quot;m&quot;;
            } else {
                overallDuration = this.overallDurationInSecond / 60 + &quot;m&quot;;
            }
        }

        sb.append(&quot;  &lt;td class='th' align=right&gt;&quot;).append(overallDuration).append(&quot;&lt;/td&gt;\n&quot;);
        sb.append(&quot;&lt;/tr&gt;\n&quot;);
        sb.append(&quot;&lt;/table&gt;&quot;);
        return sb.toString();
    }

    String generateDetail() {
        StringBuilder sb = new StringBuilder();
        Iterator var2 = this.testPackageResults.values().iterator();

        while(var2.hasNext()) {
            TestPackageResult testPackageResult = (TestPackageResult)var2.next();
            this.generateClassBanner(sb, testPackageResult);
            int numOmittedPassedCases = 0;
            sb.append(&quot;&lt;table border=0 width=1200 cellspacing=1&gt;\n&quot;);

            TestClassResult testClassResult;
            for(Iterator var5 = testPackageResult.getTestClassResults().iterator(); var5.hasNext(); numOmittedPassedCases += testClassResult.getPassedTestResults().size()) {
                testClassResult = (TestClassResult)var5.next();
                List&lt;TestResult&gt; testResults = new ArrayList();
                testResults.addAll(testClassResult.getFailedTestResults());
                testResults.addAll(testClassResult.getSkippedTestResults());
                testResults.addAll(testClassResult.getPassedTestResults());
                Iterator var8 = testResults.iterator();

                while(var8.hasNext()) {
                    TestResult testResult = (TestResult)var8.next();
                    String testClassSimpleName = testClassResult.getTestClassName().substring(testClassResult.getTestClassName().lastIndexOf(&quot;.&quot;) + 1);
                    String classPath = testClassResult.getTestClassName().replace(&quot;.&quot;, &quot;/&quot;);
                    String testNameHref = &quot;&lt;a href='http://git.jd.com/cloud-storage/oss-test/blob/master/jss_test/src/main/java/&quot; + classPath + &quot;.java' class='source' target='_blank'&gt;&quot; + testClassSimpleName + &quot;&lt;/a&gt; - &quot; + testResult.getName();
                    String statusWithColor = ReportUtil.generateStatusWithColor(testResult.getStatus());
                    String duration = ReportUtil.generateDuration(testResult.getStartTimeInMillis(), testResult.getEndTimeInMillis());
                    sb.append(&quot;&lt;tr&gt;&quot;);
                    sb.append(&quot;  &lt;td width=5%&gt;&quot;).append(statusWithColor).append(&quot;&lt;/td&gt;&quot;);
                    sb.append(&quot;  &lt;td width=80%&gt;&quot;).append(testNameHref).append(&quot;&lt;/td&gt;&quot;);
                    sb.append(&quot;  &lt;td width=5%&gt;&quot;).append(statusWithColor).append(&quot;&lt;/td&gt;&quot;);
                    sb.append(&quot;  &lt;td width=10% align=right&gt;&quot;).append(duration).append(&quot;&lt;/td&gt;&quot;);
                    sb.append(&quot;&lt;/tr&gt;\n&quot;);
                }
            }

            sb.append(&quot;&lt;/table&gt;\n&quot;);
        }

        return sb.toString();
    }

    void generateClassBanner(StringBuilder sb, TestPackageResult testPackageResult) {
        sb.append(&quot;&lt;hr align=left width=1200&gt;\n&quot;);
        sb.append(&quot;&lt;table border=0 width=1200 cellspacing=1&gt;\n&quot;);
        sb.append(&quot;&lt;tr&gt;\n&quot;);
        sb.append(&quot;  &lt;td class='packagebanner'&gt;&quot;).append(&quot;&lt;a name='&quot;).append(testPackageResult.getTestPackageName()).append(&quot;'&gt;&quot;).append(testPackageResult.getTestPackageName()).append(&quot;&lt;/a&gt;&quot;).append(&quot;&lt;/td&gt;\n&quot;);
        sb.append(&quot;  &lt;td align=right&gt;&quot;).append(DateUtil.formatTime(testPackageResult.getStartTimeInMillis(), DateUtil.FORMAT_SIMPLE, TimeZone.getTimeZone(&quot;GMT+8&quot;))).append(&quot;&lt;/td&gt;\n&quot;);
        sb.append(&quot;&lt;/tr&gt;\n&quot;);
        sb.append(&quot;&lt;/table&gt;\n&quot;);
        sb.append(&quot;&lt;hr align=left width=1200&gt;\n&quot;);
    }

    private void publishHtml(String outputFile) {
        logger.info(&quot;Report file: {}&quot;, this.outputDirectoryName + File.separator + outputFile);
        this.writeToFile(this.outputDirectoryName, outputFile, this.html);
        this.writeToFile(this.outputDirectoryName, &quot;summary&quot;, this.getResultSummary() + &quot;\n&quot;);
    }

    private void writeToFile(String directoryName, String fileName, String content) {
        File outputFile = new File(directoryName, fileName);
        outputFile.getParentFile().mkdirs();

        try {
            outputFile.createNewFile();
            FileUtils.writeStringToFile(outputFile, content, Charset.defaultCharset());
        } catch (IOException var6) {
            logger.error(&quot;Exception when write to file {}.&quot;, outputFile.getPath(), var6);
        }

    }

    private static List&lt;String&gt; mapToPrintableList(Map&lt;String, String&gt; map, int numEntryPerNode) {
        int numEntry = 0;
        List&lt;String&gt; list = new ArrayList();
        StringBuilder sb = new StringBuilder();
        int count = 0;
        Iterator var6 = map.entrySet().iterator();

        while(true) {
            do {
                if (!var6.hasNext()) {
                    return list;
                }

                Entry&lt;String, String&gt; e = (Entry)var6.next();
                ++count;
                sb.append((String)e.getKey()).append(&quot;: &quot;).append((String)e.getValue()).append(&quot; | &quot;);
                ++numEntry;
            } while(numEntry != numEntryPerNode &amp;&amp; count != map.size());

            list.add(sb.toString().substring(0, sb.length() - 3));
            sb = new StringBuilder();
            numEntry = 0;
        }
    }

    public static void main(String[] args) {
        Map&lt;String, String&gt; map = new LinkedHashMap&lt;String, String&gt;() {
            {
                this.put(&quot;Application&quot;, &quot;jss-cloud-storage&quot;);
                this.put(&quot;Branch&quot;, &quot;develop&quot;);
                this.put(&quot;Test code branch&quot;, &quot;develop&quot;);
                this.put(&quot;k4&quot;, &quot;v4&quot;);
                this.put(&quot;k5&quot;, &quot;v5&quot;);
            }
        };
        List&lt;String&gt; list = mapToPrintableList(map, 3);
        Iterator var3 = list.iterator();

        while(var3.hasNext()) {
            String s = (String)var3.next();
            System.out.println(s);
        }

    }

    static {
        TEST_JOURNAL_PATH_TO_FILE = &quot;..&quot; + File.separator + &quot;log&quot; + File.separator + &quot;jss_test.log&quot;;
    }
}</code></pre>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li>
<ul>
<li><a href="#testngreportlistener">TestNgReportListener</a></li>
<li><a href="#testngresultcollector">TestNgResultCollector</a></li>
<li><a href="#htmltestreport">HtmlTestReport</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://chaosreigned.github.io/post/niu-dun-die-dai-fa-ji-suan-kai-fang/">
              <h3 class="post-title">
                牛顿迭代法计算开方
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://chaosreigned.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
